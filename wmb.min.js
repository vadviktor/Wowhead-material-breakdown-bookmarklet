var ikon={};ikon.wmb={baseUrl:"http://wmb.ikon.org.hu/",debug:false,output_element:null,reagents:null,getAnchorElement:function(){var a=jqikon("h2[class*='clear']");var b=a.length;var i=0;for(i=0;i<b;i++){if(jqikon(a[i]).text()==='Contribute'){return jqikon(a[i]).parent()}}var c="No element found as an output anchor";if(this.debug){console.error(c)}},getItemIdFromUrl:function(a){var r=/item=[0-9]{1,}/;var m=a.match(r);var s=m[0].split('=');return s[1]},disassemble:function(){if(jqikon('#ikon_wmb_output').length===1){var a="Material breakdown already launched";if(this.debug){console.warn(a)}alert(a);return false}if(!this.isItemCraftable(this.getItemIdFromUrl(document.URL))){alert('This item is not crafted by any professions. Choose another one!')}this.dumpOutput('<div class="text">'+'<h2 id="ikon_wmb_header" class="clear">Material breakdown</h2>'+'<div class="block-bg"></div>'+'</div>');this.dumpOutput('<div id="ikon_wmb_prgogress" style="color:#ffd100">'+'Gathering material data is in progress, please be patient, this could take a minute!'+'</div>');this.getItemReagents()},isItemCraftable:function(d){var e=jqikon.ajax({type:'GET',async:false,url:'http://www.wowhead.com/item='+d+'&xml',dataType:'xml',success:function(a,b,c){if(ikon.wmb.debug){console.log(a);console.log(b);console.log(c);console.log(jqikon(a).find('createdBy>spell:first reagent'))}},error:function(a,b,c){if(ikon.wmb.debug){console.error(a);console.error(b);console.error(c)}}}).responseXML;return jqikon(e).find('createdBy>spell:first reagent').length>0?true:false},displayTierReagents:function(){var a='<div class="listview"><table class="listview-mode-default">';var b=0;for(b=0;b<this.reagents.length;b++){a+='<thead><tr><th><div><a href="javascript:;"><span>'+'<span>TIER '+b+'</span>'+'</span></a></div></th></tr></thead>'+'<tbody><tr>'+'<td style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; ">'+'<div style="margin-top: 0px; margin-right: auto; margin-bottom: 0px; margin-left: auto; ">';var c=0;for(c=0;c<this.reagents[b].length;c++){var r=this.reagents[b][c];a+='<div class="iconmedium" style="float: left; ">'+'<ins style="background-image: url(http://wow.zamimg.com/images/wow/icons/medium/'+r.icon+'.jpg); "></ins>'+'<del></del>'+'<a href="/item='+r.id+'"></a>'+'<span style="right: 0px; bottom: 0px; position: absolute; " class="glow q1">'+'<div style="position: absolute; white-space: nowrap; left: -1px; top: -1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: -1px; top: 0px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: -1px; top: 1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 0px; top: -1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 0px; top: 0px; z-index: 4; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 0px; top: 1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 1px; top: -1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 1px; top: 0px; color: black; z-index: 2; ">'+r.number+'</div>'+'<div style="position: absolute; white-space: nowrap; left: 1px; top: 1px; color: black; z-index: 2; ">'+r.number+'</div>'+'<span style="visibility: hidden; ">'+r.number+'</span>'+'</span>'+'</div>'}a+='</div>'+'</td>'+'</tr>'+'</tbody>'}a+='</table></div>';this.dumpOutput(a)},getItemReagents:function(){jqikon.getJSON(this.baseUrl+"wmb.php?callback=?",{itemid:ikon.wmb.getItemIdFromUrl(document.URL)},function(a){if(typeof a.error!='undefined'){alert(a.error)}else{ikon.wmb.reagents=a;if(ikon.wmb.debug){console.log(ikon.wmb.reagents)}ikon.wmb.displayTierReagents()}jqikon('#ikon_wmb_prgogress').remove()})},dumpOutput:function(a){if(this.output_element===null){jqikon('<div/>',{id:'ikon_wmb_output'}).insertBefore(this.getAnchorElement());this.output_element=jqikon('#ikon_wmb_output')}jqikon(this.output_element).append(a)}};
